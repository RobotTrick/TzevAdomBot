from pony.orm import *

# ====== DB ======
db = Database()


class User(db.Entity):
    uid = PrimaryKey(int, auto=True)
    area1 = Set(lambda: Area)


class Area(db.Entity):
    name = Required(str)
    users = Set(lambda: User)

    def get_users(self) -> list:
        ids = []
        for user in self.users:
            ids.append(user.uid)
        return ids  # ×”×—×–×¨×ª ×¨×©×™××ª ×× ×•×™×™× ×œ×¤×™ ××–×•×¨


db.bind(provider='sqlite', filename='tzevAdom.sqlite', create_db=True)
db.generate_mapping(create_tables=True)


# ==== MSG =====
class Msg:
    bad_param = "âŒ ×œ× ×”×•×–× ×• ×¤×¨××˜×¨×™× ):\n×”×¤×•×¨××˜ ×”× ×›×•×Ÿ ×œ×©×™××•×© ×‘×¤×§×•×“×” ×”×•×:\n\n" \
                "```/add ×©× ×”××–×•×¨" \
                "\n/remove ×©× ×”××–×•×¨```"
    _areas_url = "https://m100achuz.ml/areas.html"  # ×¨×©×™××ª ×”××–×•×¨×™×
    area_not_found = f"âŒ ×œ× × ××¦××” ×¢×™×¨/××–×•×¨. ×ª×•×›×œ×• ×œ××¦×•× ××ª ×¨×©×™××ª ×”×¢×¨×™× [×‘×§×™×©×•×¨ ×”×‘×]({_areas_url})."
    success_config = "âœ… × ×¨×©××ª ×‘×”×¦×œ×—×” ×œ×§×‘×œ×ª ×”×ª×¨××•×ª ×¦×‘×¢ ××“×•× ×œ××–×•×¨: **{}.**"
    _info_url = "https://www.oref.org.il/12487-15894-he/Pakar.aspx"  # ×”×•×¨××•×ª ×¤×™×§×•×“ ×”×¢×•×¨×£
    alarms = "ğŸ›‘ ××–×¢×§×ª ×¦×‘×¢ ××“×•× ×›×¢×ª ×‘××–×•×¨×š: **{}**. \n\nğŸ•’ ×–××Ÿ ×”×’×¢×” ×œ××¨×—×‘ ××•×’×Ÿ: **{}.**\nğŸŒ ×œ××™×“×¢ × ×•×¡×£ ×”×›× ×¡×• [×œ××ª×¨ " \
             f"×¤×™×§×•×“ ×”×¢×•×¨×£]({_info_url}). "
    none_subscribes = "â“ × ×¨××” ×©×¢×“×™×™×Ÿ ×œ× × ×¨×©××ª ×œ××–×•×¨ ×›×œ×©×”×•×. ×ª×•×›×œ ×œ×”×¨×©× ×œ××–×•×¨×š ×¢×œ ×™×“×™ ×¤×§×•×“×ª /add."
    not_subscribe = "âŒ ××™× ×š ×¨×©×•× ×œ××–×•×¨ ×–×”"
    success_remove = "âŒ ××–×•×¨ ×–×” ×”×•×¡×¨ ××¨×©×™××ª ×”××–×•×¨×™× ×©×œ×š"
    repo_url = "https://github.com/RobotTrick/TzevAdomBot"
    button_link = "ğŸ’¬ ×§×•×“ ×”××§×•×¨ ×©×œ ×”×‘×•×˜"
    id_channel = -1001396042264

    help = "**×œ×”×œ×Ÿ ×”×¤×§×•×“×•×ª ×”× ×ª××›×•×ª ×‘×‘×•×˜:**\n\n" \
           "â˜‘ï¸ /add\n" \
           "××©××© ×œ×”×•×¡×¤×ª ××–×•×¨/×¢×™×¨ ×œ×¨×©×™××ª ×”××–×•×¨×™× ×©×œ×š. ×”×©×™××•×© ×‘×¤×§×•×“×” ××ª×‘×¦×¢ ×‘×××¦×¢×•×ª ×©×œ×™×—×ª ×”×¤×§×•×“×” ×™×—×“ ×¢× ×©× ×”××–×•×¨. " \
           "×œ×“×•×’××”:\n" \
           "`/add ×™×¨×•×©×œ×™× - ××–×¨×—, ××¨×›×– ×•××¢×¨×‘`\n" \
           f"\n×©×™××• ×œ×‘ ×©×”×‘×•×˜ ××§×‘×œ ××š ×•×¨×§ ×©××•×ª ××“×•×™×§×™×, ××ª×•×š ×”×¨×©×™××” ×”××•×¤×™×¢×” [×›××Ÿ]({_areas_url}). ×× ×—× ×• ×××œ×™×¦×™× ×œ×”×›× ×¡ " \
           f"×œ×¨×©×™××”, ×œ×¢×©×•×ª ×—×™×¤×•×© ×‘×“×£ (×“×¨×š ×“×¤×“×¤×Ÿ Chrome), ×•×œ×•×•×“× ×©×™×© ×‘×¨×©×™××” ××ª ×”×©× ×”××“×•×™×§.\n\n" \
           "â˜‘ï¸ /remove\n" \
           "×”×¡×¨×ª ××–×•×¨ ××¨×©×™××ª ×”××–×•×¨×™× ×©×œ×š. ××•×¤×Ÿ ×”×©×™××•×© ×‘×¤×§×•×“×” ×”×•× ×‘×“×•××” ×œ×¤×§×•×“×ª /add:\n" \
           "`/remove ×™×¨×•×©×œ×™× - ××–×¨×—, ××¨×›×– ×•××¢×¨×‘`\n\n" \
           "â˜‘ï¸ /list" \
           "\n×¨×©×™××ª ×›×œ ×”××–×•×¨×™× ×©×”× ×š ×¨×©×•×/×” ×œ×§×‘×œ×ª ×”×ª×¨××•×ª ×¢×œ×™×”×.\n\n" \
           "×”×¦×˜×¨×¤×• ×œ×¢×¨×•×¥ ×”×”×ª×¨××•×ª ×¢×œ ×× ×ª ×œ×§×‘×œ ×”×ª×¨××•×ª ××›×œ ×—×œ×§×™ ×”××¨×¥ - T.me/TzevAdomChannel\n\n" \
           "×©×™××• ×œ×‘ ×›×™ ×× ×• ××¡×™×¨×™× ×××™×ª× ×• ×›×œ ××—×¨×™×•×ª ×©×ª×™×’×¨× ×× ×–×§×™× ×‘××™ ×ª×¤×§×•×“ ×—×œ×§×™ ××• ××œ× ×©×œ ×”×‘×•×˜ ×¢×§×‘ ×‘×¢×™×” ×‘×©×¨×ª×™× ×•/××• " \
           "××’×‘×œ×•×ª ×”×¤×¦×” ×©×œ ×˜×œ×’×¨×.\n\n" \
           "×‘×•×˜ ×–×” × ×•×¦×¨ ×¢×œ ×™×“×™ " \
           "[Yeuda-By](t.me/m100achuzBots) && [David Lev](t.me/davidlev) ××¦×•×•×ª " \
           "[×¨×•×‘×•×˜×¨×™×§](https://t.me/RobotTrick)."

    start = """**×‘×¨×•×›×™× ×”×‘××™× ×œ×¨×•×‘×•×˜ ×”×ª×¨××•×ª ×¦×‘×¢ ××“×•×!**

×¨×•×‘×•×˜ ×–×” ×™×©×œ×— ×œ×›× ×”×ª×¨××” ×‘×›×œ ×¤×¢× ×©× ×©××¢×ª ××–×¢×§×” ×‘×¢×¨×™× ××• ×‘××™×–×•×¨×™× ×©××œ×™×”× × ×¨×©××ª×.

×œ×”×¡×‘×¨ ×©×™××•×© ×‘×‘×•×˜ ×©×œ×—×• /help."""

    def list_subscribes(subs: list) -> str:
        """ ×”×—×–×¨×ª ×”×•×“×¢×ª "×¨×©×™××ª ×× ×•×™×™×" ×¢×œ ×¤×™ ×œ×™×¡×˜ ×©×œ ××™×–×•×¨×™× """
        _len = len(subs)
        str_subs = "\n".join(subs)
        txt = f"**ğŸ”” ×¡×š ×›×œ ×”××–×•×¨×™× ×©×”× ×š ×¨×©×•× ××œ×™×”×:{_len}.**" \
              f"\n\n```{str_subs}```\n\n×œ×”×¡×¨×ª ××–×•×¨, ×”×©×ª××©×• ×‘×¤×§×•×“×ª /remove."
        return txt

    @property
    def info_url(self):
        return self._info_url
